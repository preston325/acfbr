Part 1 — Local Docker → ECR

1) Confirm Image Exists
docker images | grep acfbr-app

2) Set Variables
AWS_REGION=us-west-2
AWS_ACCOUNT_ID=$(aws sts get-caller-identity --query Account --output text)
ECR_REPO=acfbr
IMAGE_TAG=latest

3) Make sure ECR_REPO=acfbr exists in AWS ECR Management Console

4)Login Docker to ECR
aws ecr get-login-password --region $AWS_REGION \
| docker login --username AWS --password-stdin \
${AWS_ACCOUNT_ID}.dkr.ecr.${AWS_REGION}.amazonaws.com

5) Important on Mac (Apple Silicon): build for linux/amd64
docker buildx create --use --name acfbr_builder 2>/dev/null || docker buildx use acfbr_builder

docker buildx build \
  --platform linux/amd64 \
  -t ${AWS_ACCOUNT_ID}.dkr.ecr.${AWS_REGION}.amazonaws.com/${ECR_REPO}:${IMAGE_TAG} \
  --push .

Part 2 — Run the container in ECS (Fargate + ALB)

6. Create an ECS cluster (console)
AWS Console → ECS → Clusters → Create cluster
Name: acfbr-cluster
Infrastructure: Fargate
Create

7. Create a Task Definition (console)
ECS → Task definitions → Create new
Launch type: Fargate
OS: Linux
CPU/Memory: start with 0.25 vCPU / 0.5–1 GB
Container settings
Name: acfbr
Image: <ACCOUNT_ID>.dkr.ecr.<region>.amazonaws.com/acfbr:latest
Port mapping: 3000

Env vars: add your DB vars (you can use EITHER method):

Method 1: Use DATABASE_URL (recommended - single variable)
DATABASE_URL=postgresql://postgres:Snoqualmie2015%21@tdpllc-1.cqgd5zbaiuii.us-west-2.rds.amazonaws.com:5432/acfbr?sslmode=require

Method 2: Use individual variables (alternative)
DB_HOST=tdpllc-1.cqgd5zbaiuii.us-west-2.rds.amazonaws.com
DB_PORT=5432
DB_NAME=acfbr
DB_USER=postgres
DB_PASSWORD=Snoqualmie2015!

Also add other required env vars:
JWT_SECRET=your-secret-key-change-in-production
SPORTSDB_API_KEY=428457
NODE_ENV=production
SMTP_HOST=smtp-relay.brevo.com
SMTP_PORT=587
SMTP_USER=a046c2001@smtp-brevo.com
SMTP_PASSWORD=Etc4dfDOsMUyvISA
SMTP_FROM=americas.cfb.rankings@gmail.com
APP_URL=https://your-domain.com (or your ALB DNS name)

Logging (do this)
awslogs, log group /ecs/acfbr, stream prefix ecs

Save task definition.

